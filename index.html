<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>DASHBOARD JABATAN FUNGSIONAL</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- ICON -->
<link rel="stylesheet"
 href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
:root{
  --pri:#2563eb;
  --bg:#f8fafc;
  --card:#ffffff;
  --line:#e5e7eb;
  --text:#0f172a;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,Segoe UI,Arial;
  background:var(--bg);
  color:var(--text);
}

/* HEADER */
header{
  padding:12px 22px;
  background:linear-gradient(135deg,#2563eb,#1e40af);
  color:#fff;
}
header h1{
  margin:0;
  font-size:18px;
  letter-spacing:.3px;
}

/* CONTAINER */
.container{padding:14px}

/* SEARCH */
.search{
  max-width:320px;
  margin-bottom:10px;
}
.search input{
  width:100%;
  padding:8px 12px;
  font-size:13px;
  border-radius:999px;
  border:1px solid #c7d2fe;
}

/* TABLE BOX */
.table-box{
  background:var(--card);
  border-radius:14px;
  overflow:auto;
  max-height:78vh;
  box-shadow:0 8px 18px rgba(0,0,0,.06);
}

/* TABLE */
table{
  width:100%;
  border-collapse:collapse;
  table-layout:fixed;
  font-size:12px;
}

/* HEADER FREEZE */
thead th{
  position:sticky;
  top:0;
  background:#eef2ff;
  z-index:2;
}

/* CELL */
th,td{
  padding:8px 10px;
  border-bottom:1px solid var(--line);
  overflow:hidden;
  text-overflow:ellipsis;
}

/* COLUMN WIDTH */
th:nth-child(1), td:nth-child(1){ width:24%; }
th:nth-child(2), td:nth-child(2){ width:18%; }
th:nth-child(3), td:nth-child(3){ width:14%; }
th:nth-child(4), td:nth-child(4){ width:6%; text-align:center; }
th:nth-child(5), td:nth-child(5){ width:38%; }

/* ROW */
tbody tr:hover{background:#f1f5f9}

/* NAMA PEGAWAI */
td.nama{
  font-size:14px;
  font-weight:600;
  color:#0f172a;
}

/* CATATAN */
.catatan{
  width:100%;
  min-height:32px;
  font-size:12px;
  padding:6px;
  border-radius:8px;
  border:1px solid #c7d2fe;
  background:#f8fafc;
}

/* BUTTON */
.btn{
  margin-top:4px;
  font-size:11px;
  padding:5px 14px;
  border:none;
  border-radius:999px;
  cursor:pointer;
  background:linear-gradient(135deg,#2563eb,#1e40af);
  color:#fff;
}
.btn.loading{
  background:#94a3b8;
  cursor:wait;
}

/* FOLDER ICON */
.folder a{
  color:#2563eb;
  font-size:18px;
}
</style>
</head>

<body>

<header>
  <h1>DASHBOARD JABATAN FUNGSIONAL</h1>
</header>

<div class="container">

  <div class="search">
    <input id="search" placeholder="Cari nama pegawai...">
  </div>

  <div class="table-box">
    <table>
      <thead>
        <tr>
          <th>Nama</th>
          <th>NIP</th>
          <th>HP</th>
          <th>Folder</th>
          <th>Catatan</th>
        </tr>
      </thead>
      <tbody id="rows"></tbody>
    </table>
  </div>

</div>

<script>
const SHEET =
"https://docs.google.com/spreadsheets/d/1t_0nZta960SB78FgxwKGJHiRpCO_WWz5XEORnSFwbik/gviz/tq?tqx=out:json&sheet=Jabfung";

const GAS_URL = "https://script.google.com/macros/s/AKfycbybmvR69DeeJAGZUOJkllGjJ0bHsDRFEK3a4bQdrrdajhgov1i5tjljgyH8UhgW6Hpc/exec";

let data=[];

/* LOAD DATA */
fetch(SHEET)
.then(r=>r.text())
.then(t=>{
  const j = JSON.parse(t.substr(47).slice(0,-2));
  data = j.table.rows.reverse();
  render(data);
});

/* RENDER TABLE */
function render(arr){
  const tb = document.getElementById("rows");
  tb.innerHTML="";
  arr.forEach(r=>{
    const nama = r.c[0]?.v || "";
    const nip = r.c[1]?.v || "";
    const hp = r.c[2]?.v || "";
    const folder = r.c[5]?.v || "";
    const cat = r.c[6]?.v || "";

    tb.innerHTML += `
    <tr>
      <td class="nama">${nama}</td>
      <td>${nip}</td>
      <td>${hp}</td>
      <td class="folder">
        <a href="${folder}" target="_blank" title="Buka Folder">
          <i class="fa-solid fa-folder-open"></i>
        </a>
      </td>
      <td>
        <textarea class="catatan" id="c_${nip}">${cat}</textarea>
        <button class="btn" id="b_${nip}" onclick="save('${nip}')">Save</button>
      </td>
    </tr>`;
  });
}

/* SAVE CATATAN */
function save(nip){
  const btn = document.getElementById("b_"+nip);
  const cat = document.getElementById("c_"+nip).value;

  btn.textContent="Saving...";
  btn.classList.add("loading");
  btn.disabled=true;

  fetch(GAS_URL,{
    method:"POST",
    mode:"no-cors",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ nip:nip, catatan:cat })
  });

  setTimeout(()=>{
    btn.textContent="Saved";
    setTimeout(()=>{
      btn.textContent="Save";
      btn.classList.remove("loading");
      btn.disabled=false;
    },900);
  },700);
}

/* SEARCH */
document.getElementById("search").oninput = e=>{
  const q = e.target.value.toLowerCase();
  render(data.filter(r=>r.c[0]?.v.toLowerCase().includes(q)));
};
</script>

</body>
</html>
