<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>DASBOARD JABATAN FUNGSIONAL</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --pri:#2563eb;
  --bg:#f8fafc;
  --card:#ffffff;
  --line:#e5e7eb;
  --text:#0f172a;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,Segoe UI,Arial;
  background:var(--bg);
  color:var(--text);
}
header{
  padding:14px 24px;
  background:linear-gradient(135deg,#2563eb,#1e40af);
  color:#fff;
}
header h1{
  margin:0;
  font-size:20px;
  letter-spacing:.3px;
}

.container{padding:16px}

.search{
  max-width:320px;
  margin-bottom:10px;
}
.search input{
  width:100%;
  padding:8px 10px;
  border-radius:8px;
  border:1px solid #c7d2fe;
  font-size:13px;
}

.table-box{
  background:var(--card);
  border-radius:14px;
  overflow:auto;
  box-shadow:0 8px 20px rgba(0,0,0,.06);
}

table{
  width:100%;
  border-collapse:collapse;
  font-size:13px;
}
thead{
  position:sticky;
  top:0;
  background:#eef2ff;
  z-index:1;
}
th,td{
  padding:8px 10px;
  border-bottom:1px solid var(--line);
  white-space:nowrap;
}
tbody tr:hover{background:#f1f5f9}

.catatan{
  width:220px;
  min-height:34px;
  resize:vertical;
  font-size:12px;
  padding:5px;
  border-radius:6px;
  border:1px solid #c7d2fe;
}

.btn{
  margin-top:4px;
  padding:5px 10px;
  font-size:11px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  background:var(--pri);
  color:#fff;
}
.btn.loading{
  background:#94a3b8;
  cursor:not-allowed;
}

.folder a{
  color:var(--pri);
  font-weight:600;
  text-decoration:none;
}
</style>
</head>

<body>
<header>
  <h1>DASBOARD JABATAN FUNGSIONAL</h1>
</header>

<div class="container">

  <div class="search">
    <input id="search" placeholder="Cari Nama Pegawai...">
  </div>

  <div class="table-box">
    <table>
      <thead>
        <tr>
          <th>Nama</th>
          <th>NIP</th>
          <th>HP</th>
          <th>Folder</th>
          <th>Catatan</th>
        </tr>
      </thead>
      <tbody id="rows"></tbody>
    </table>
  </div>

</div>

<script>
const SHEET =
"https://docs.google.com/spreadsheets/d/1t_0nZta960SB78FgxwKGJHiRpCO_WWz5XEORnSFwbik/gviz/tq?tqx=out:json&sheet=Jabfung";

const GAS_URL = "https://script.google.com/macros/s/AKfycbwbn3PkgDjwXIK5r3ZK6iqAbcNDVaUIYoc8btYDFuFz9BiFzlEP1jk-NfMfKYSju25B/exec";

let data = [];

fetch(SHEET)
.then(r=>r.text())
.then(t=>{
  const j = JSON.parse(t.substr(47).slice(0,-2));
  data = j.table.rows.reverse();
  render(data);
});

function render(arr){
  const tb = document.getElementById("rows");
  tb.innerHTML="";
  arr.forEach(r=>{
    const nama = r.c[0]?.v || "";
    const nip = r.c[1]?.v || "";
    const hp = r.c[2]?.v || "";
    const folder = r.c[5]?.v || "";
    const cat = r.c[6]?.v || "";

    tb.innerHTML += `
    <tr>
      <td>${nama}</td>
      <td>${nip}</td>
      <td>${hp}</td>
      <td class="folder"><a href="${folder}" target="_blank">Buka</a></td>
      <td>
        <textarea class="catatan" id="cat_${nip}">${cat}</textarea>
        <button class="btn" id="btn_${nip}" onclick="save('${nip}')">Save</button>
      </td>
    </tr>`;
  });
}

function save(nip){
  const btn = document.getElementById("btn_"+nip);
  const catatan = document.getElementById("cat_"+nip).value;

  btn.textContent="Saving...";
  btn.classList.add("loading");
  btn.disabled=true;

  fetch(GAS_URL,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ nip, catatan })
  })
  .then(r=>r.json())
  .then(res=>{
    btn.textContent = res.success ? "Saved" : "Error";
    setTimeout(()=>{
      btn.textContent="Save";
      btn.classList.remove("loading");
      btn.disabled=false;
    },1200);
  })
  .catch(()=>{
    btn.textContent="Error";
    btn.disabled=false;
  });
}

document.getElementById("search").oninput = e=>{
  const q = e.target.value.toLowerCase();
  render(data.filter(r=>r.c[0]?.v.toLowerCase().includes(q)));
};
</script>

</body>
</html>
