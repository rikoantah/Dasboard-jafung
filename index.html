<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>DASBOARD JABATAN FUNGSIONAL</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --pri:#2563eb;
  --bg:#f1f5f9;
  --card:#ffffff;
  --text:#0f172a;
  --muted:#64748b;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,Segoe UI,Arial;
  background:var(--bg);
  color:var(--text);
}
header{
  background:linear-gradient(135deg,var(--pri),#1e40af);
  color:#fff;
  padding:22px 32px;
}
header h1{margin:0;font-size:26px}

.container{
  padding:25px;
}
.search-box{
  max-width:420px;
  margin-bottom:18px;
}
.search-box input{
  width:100%;
  padding:12px 14px;
  border-radius:10px;
  border:1px solid #cbd5f5;
  font-size:15px;
}

.table-wrap{
  background:var(--card);
  border-radius:16px;
  overflow:hidden;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
}
table{
  width:100%;
  border-collapse:collapse;
}
thead{
  background:#e0e7ff;
}
th,td{
  padding:14px 16px;
  border-bottom:1px solid #e5e7eb;
  vertical-align:top;
}
th{text-align:left;font-size:14px}
td{font-size:14px}
tbody tr:hover{background:#f8fafc}

.catatan{
  width:100%;
  min-height:60px;
  border:1px solid #c7d2fe;
  border-radius:8px;
  padding:8px;
  resize:vertical;
  font-family:inherit;
}
.btn{
  margin-top:6px;
  background:var(--pri);
  color:#fff;
  border:none;
  padding:6px 12px;
  border-radius:8px;
  cursor:pointer;
  font-size:13px;
}
.btn:hover{opacity:.9}

.folder a{
  color:var(--pri);
  text-decoration:none;
  font-weight:600;
}
</style>
</head>

<body>
<header>
  <h1>DASBOARD JABATAN FUNGSIONAL</h1>
</header>

<div class="container">

  <div class="search-box">
    <input id="search" placeholder="Cari Nama Pegawai..." autocomplete="off">
  </div>

  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>Nama</th>
          <th>NIP</th>
          <th>HP</th>
          <th>Folder</th>
          <th>Catatan</th>
        </tr>
      </thead>
      <tbody id="data"></tbody>
    </table>
  </div>

</div>

<script>
const SHEET_URL =
"https://docs.google.com/spreadsheets/d/1t_0nZta960SB78FgxwKGJHiRpCO_WWz5XEORnSFwbik/gviz/tq?tqx=out:json&sheet=Jabfung";

const GAS_URL = "https://script.google.com/macros/s/AKfycbz36U8zbabqUFpxQNhQFtnMPiNU4gUqSOE0Jn7TY8zILCZxCnSw0tTyXKJsQS3rtsYD/exec";

let rows = [];

fetch(SHEET_URL)
.then(res => res.text())
.then(text => {
  const json = JSON.parse(text.substr(47).slice(0,-2));
  rows = json.table.rows.reverse(); // TERBALIK
  render(rows);
});

function render(data){
  const tbody = document.getElementById("data");
  tbody.innerHTML="";
  data.forEach(r=>{
    const nama = r.c[0]?.v || "";
    const nip = r.c[1]?.v || "";
    const hp = r.c[2]?.v || "";
    const folder = r.c[5]?.v || "";
    const catatan = r.c[6]?.v || "";

    tbody.innerHTML += `
    <tr>
      <td>${nama}</td>
      <td>${nip}</td>
      <td>${hp}</td>
      <td class="folder"><a href="${folder}" target="_blank">Buka</a></td>
      <td>
        <textarea class="catatan" id="c_${nip}">${catatan}</textarea>
        <button class="btn" onclick="save('${nip}')">Simpan</button>
      </td>
    </tr>`;
  });
}

function save(nip){
  const catatan = document.getElementById("c_"+nip).value;
  fetch(GAS_URL,{
    method:"POST",
    body:JSON.stringify({nip,catatan})
  })
  .then(r=>r.json())
  .then(()=>alert("Catatan tersimpan"));
}

document.getElementById("search").addEventListener("input",e=>{
  const q = e.target.value.toLowerCase();
  const f = rows.filter(r=>r.c[0]?.v.toLowerCase().includes(q));
  render(f);
});
</script>

</body>
</html>
